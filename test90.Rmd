---
title: "Untitled"
author: "TC"
date: "1/3/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown


```{r}
df = data.table::fread(
"1950	86.02 40.81 
1950	76.98 38.70 
1951	83.16 40.54 
1951	89.95 41.60 
1951	76.66 38.69 
1952	81.01 39.67 
1953	81.04 39.46 
1954	82.30 41.33 
1954	84.75 41.75 
1954	83.55 38.90 
1954	77.31 38.69 
1954	81.05 38.15 
1955	83.61 41.96 
1955	81.61 41.11 
1955	83.83 39.08 
1955	77.25 38.75 
1955	80.65 38.15 
1957	79.38 39.75 
1958	83.50 41.50 
1959	82.84 41.34 
1960	90.50 42.00 
1960	76.72 39.15 
1960	79.58 39.58 
1962	87.82 39.49 
1964	85.06 41.62 
1967	85.25 41.49 
1967	76.25 39.92 
1967	77.39 38.75 
1968	85.51 41.36 
1969	85.92 41.14 
1969	76.75 39.45 
1970	83.33 40.58 
1971	83.69 40.28 
1972	87.12 42.21 
1972	79.08 39.92 
1972	76.46 39.25 
1972	83.25 39.08 
1972	81.50 37.00 
1973	76.04 39.13 
1973	84.64 40.82 
1974	75.84 39.43 
1975	76.53 39.00 
1976	84.79 41.89 
1977	84.53 41.92 
1978	79.54 38.63 
1979	83.58 40.25 
1980	83.03 39.63 
1981	76.20 38.62 
1981	79.95 37.05 
1982	75.58 38.88 
1984	81.19 40.39 
1984	83.08 39.08 
1985	80.73 38.64 
1986	85.51 40.44 
1987	83.50 41.63 
1987	80.58 40.42 
1987	76.62 39.05 
1988	87.25 41.08 
1988	76.75 39.20 
1989	83.35 41.75 
1990	78.89 39.29 
1990	87.45 41.05 
1991	87.45 41.05 
1992	83.86 41.86 
1992	87.75 40.68 
1992	81.25 40.75 
1992	79.14 39.58 
1992	76.58 39.75 
1993	79.45 39.35 
1994	85.00 40.96 
1994	79.25 39.03 
1995	80.48 39.78 
1995	86.45 40.85 
1995	83.38 38.63 
1996	84.46 41.38 
1996	81.00 40.50 
1996	79.89 38.25 
1997	78.92 38.97 
1997	86.39 40.89 
1998	83.33 39.29 
1999	76.41 38.51 
1999	87.00 41.00 
1999	81.08 40.25 
1999	79.70 38.25 
2000	78.07 38.77 
2000	85.99 41.15 
2000	90.03 41.19 
2000	88.36 38.31 
2000	82.25 37.93"
)
```

```{r}
mydate = df$V1

mydate.uniq = unique(df$V1)

mydate.diff = diff(mydate.uniq)

mydate.diff
```

```{r}
rledas = rle(mydate.diff)

which(mydate.diff == 1)[1] + (0:(rledas$lengths[rledas$values==1][1]))
```

```{r}
dput(mydate.uniq)
```


```{r}
d1 = which(diff(mydate.uniq) == 1)


d1

mydate.uniq[c(d1, d1[length(d1)] + 1)]
```

```{r}
mydate.diff

rle(mydate.diff)
```

```{r}
dput(mydate)
```


```{r}

mydate = c(1950L, 1950L, 1951L, 1951L, 1951L, 1952L, 1953L, 1954L, 1954L, 
1954L, 1954L, 1954L, 1955L, 1955L, 1955L, 1955L, 1955L, 1957L, 
1958L, 1959L, 1960L, 1960L, 1960L, 1962L, 1964L, 1967L, 1967L, 
1967L, 1968L, 1969L, 1969L, 1970L, 1971L, 1972L, 1972L, 1972L, 
1972L, 1972L, 1973L, 1973L, 1974L, 1975L, 1976L, 1977L, 1978L, 
1979L, 1980L, 1981L, 1981L, 1982L, 1984L, 1984L, 1985L, 1986L, 
1987L, 1987L, 1987L, 1988L, 1988L, 1989L, 1990L, 1990L, 1991L, 
1992L, 1992L, 1992L, 1992L, 1992L, 1993L, 1994L, 1994L, 1995L, 
1995L, 1995L, 1996L, 1996L, 1996L, 1997L, 1997L, 1998L, 1999L, 
1999L, 1999L, 1999L, 2000L, 2000L, 2000L, 2000L, 2000L)


get_start_ed = function(vdate){
  vdateuni = unique(sort(vdate)) # combine adjacent years and sort
  mydiff = diff(vdateuni) # difference between adjacent elements
  myrle = rle(mydiff) # run length encoding
  
  # get sequence start / end
  # + 1 to include the next adjacent element
  ed = cumsum(myrle$lengths) + 1
  start = c(1,ed)[1:length(ed)]
  
  
  # extract sequences based on start and end.
  df = data.frame(s = start, e = ed, v = myrle$values, l = myrle$lengths)
  dfseqs = df[which(df$v == 1),]
  sequences = lapply(1:nrow(dfseqs), function(i){
    return(vdateuni[dfseqs$s[i]: (dfseqs$e[i])])
})
  return(sequences)
}

unique(sort(mydate))

# results
get_start_ed(mydate)


```



```{r}

df = data.table::fread(
"1950	86.02 40.81 
1950	76.98 38.70 
1951	83.16 40.54 
1951	89.95 41.60 
1951	76.66 38.69 
1952	81.01 39.67 
1953	81.04 39.46 
1954	82.30 41.33 
1954	84.75 41.75 
1954	83.55 38.90 
1954	77.31 38.69 
1954	81.05 38.15 
1955	83.61 41.96 
1955	81.61 41.11 
1955	83.83 39.08 
1955	77.25 38.75 
1955	80.65 38.15 
1957	79.38 39.75 
1958	83.50 41.50 
1959	82.84 41.34 
1960	90.50 42.00 
1960	76.72 39.15 
1960	79.58 39.58 
1962	87.82 39.49 
1964	85.06 41.62 
1967	85.25 41.49 
1967	76.25 39.92 
1967	77.39 38.75 
1968	85.51 41.36 
1969	85.92 41.14 
1969	76.75 39.45 
1970	83.33 40.58 
1971	83.69 40.28 
1972	87.12 42.21 
1972	79.08 39.92 
1972	76.46 39.25 
1972	83.25 39.08 
1972	81.50 37.00 
1973	76.04 39.13 
1973	84.64 40.82 
1974	75.84 39.43 
1975	76.53 39.00 
1976	84.79 41.89 
1977	84.53 41.92 
1978	79.54 38.63 
1979	83.58 40.25 
1980	83.03 39.63 
1981	76.20 38.62 
1981	79.95 37.05 
1982	75.58 38.88 
1984	81.19 40.39 
1984	83.08 39.08 
1985	80.73 38.64 
1986	85.51 40.44 
1987	83.50 41.63 
1987	80.58 40.42 
1987	76.62 39.05 
1988	87.25 41.08 
1988	76.75 39.20 
1989	83.35 41.75 
1990	78.89 39.29 
1990	87.45 41.05 
1991	87.45 41.05 
1992	83.86 41.86 
1992	87.75 40.68 
1992	81.25 40.75 
1992	79.14 39.58 
1992	76.58 39.75 
1993	79.45 39.35 
1994	85.00 40.96 
1994	79.25 39.03 
1995	80.48 39.78 
1995	86.45 40.85 
1995	83.38 38.63 
1996	84.46 41.38 
1996	81.00 40.50 
1996	79.89 38.25 
1997	78.92 38.97 
1997	86.39 40.89 
1998	83.33 39.29 
1999	76.41 38.51 
1999	87.00 41.00 
1999	81.08 40.25 
1999	79.70 38.25 
2000	78.07 38.77 
2000	85.99 41.15 
2000	90.03 41.19 
2000	88.36 38.31 
2000	82.25 37.93"
)


df.filt =df[-(which(diff(df$V1) > 1) + 1),]

df.filt

```


```{r}
a = c(1,1,1,2,2,2,3)

diff(a)
```

```{r}
library(tidyverse)
```



```{r}
df = data.frame(a= a)

df %>%
  group_by(a) %>%
  mutate(ind = row_number())
```


```{r}

library(tidyverse)

df = data.table::fread(
"1950	86.02 40.81 
1950	76.98 38.70 
1951	83.16 40.54 
1951	89.95 41.60 
1951	76.66 38.69 
1952	81.01 39.67 
1953	81.04 39.46 
1954	82.30 41.33 
1954	84.75 41.75 
1954	83.55 38.90 
1954	77.31 38.69 
1954	81.05 38.15 
1955	83.61 41.96 
1955	81.61 41.11 
1955	83.83 39.08 
1955	77.25 38.75 
1955	80.65 38.15 
1957	79.38 39.75 
1958	83.50 41.50 
1959	82.84 41.34 
1960	90.50 42.00 
1960	76.72 39.15 
1960	79.58 39.58 
1962	87.82 39.49 
1964	85.06 41.62 
1967	85.25 41.49 
1967	76.25 39.92 
1967	77.39 38.75 
1968	85.51 41.36 
1969	85.92 41.14 
1969	76.75 39.45 
1970	83.33 40.58 
1971	83.69 40.28 
1972	87.12 42.21 
1972	79.08 39.92 
1972	76.46 39.25 
1972	83.25 39.08 
1972	81.50 37.00 
1973	76.04 39.13 
1973	84.64 40.82 
1974	75.84 39.43 
1975	76.53 39.00 
1976	84.79 41.89 
1977	84.53 41.92 
1978	79.54 38.63 
1979	83.58 40.25 
1980	83.03 39.63 
1981	76.20 38.62 
1981	79.95 37.05 
1982	75.58 38.88 
1984	81.19 40.39 
1984	83.08 39.08 
1985	80.73 38.64 
1986	85.51 40.44 
1987	83.50 41.63 
1987	80.58 40.42 
1987	76.62 39.05 
1988	87.25 41.08 
1988	76.75 39.20 
1989	83.35 41.75 
1990	78.89 39.29 
1990	87.45 41.05 
1991	87.45 41.05 
1992	83.86 41.86 
1992	87.75 40.68 
1992	81.25 40.75 
1992	79.14 39.58 
1992	76.58 39.75 
1993	79.45 39.35 
1994	85.00 40.96 
1994	79.25 39.03 
1995	80.48 39.78 
1995	86.45 40.85 
1995	83.38 38.63 
1996	84.46 41.38 
1996	81.00 40.50 
1996	79.89 38.25 
1997	78.92 38.97 
1997	86.39 40.89 
1998	83.33 39.29 
1999	76.41 38.51 
1999	87.00 41.00 
1999	81.08 40.25 
1999	79.70 38.25 
2000	78.07 38.77 
2000	85.99 41.15 
2000	90.03 41.19 
2000	88.36 38.31 
2000	82.25 37.93"
)



df.filt =df[-(which(diff(df$V1) > 1) + 1),]

df.filt %>%
  arrange(V1) %>%
  group_by(V1) %>%
  mutate(ind = row_number()) %>%
  arrange(ind) -> tmp

gg = ggplot(tmp, aes(y = ind, x = V1)) + 
  geom_point() 
gg

```




```{r}



gg = ggplot(tmp, aes(y = ind, x = V1)) + 
  geom_point() 
gg
```


